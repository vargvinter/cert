# Attaching Headers / Cookies

## Attaching headers

```php
return response($content)
            ->header('Content-Type', $type)
            ->header('X-Header-One', 'Header Value')
            ->header('X-Header-Two', 'Header Value');
```

```php
return response($content)
            ->withHeaders([
                'Content-Type' => $type,
                'X-Header-One' => 'Header Value',
                'X-Header-Two' => 'Header Value',
            ]);
```

## Attaching Cookies To Responses

```php
return response($content)
                ->header('Content-Type', $type)
                ->cookie('name', 'value', $minutes);
```

### Cookies & Encryption

* All cookies generated by Laravel are encrypted and signed.
* To disable encryption for a subset of cookies generated by app, use the `$except` property of the  `App\Http\Middleware\EncryptCookies`.

```php
/**
 * The names of the cookies that should not be encrypted.
 *
 * @var array
 */
protected $except = [
    'cookie_name',
];
```

# Redirects

```php
Route::get('dashboard', function () {
    return redirect('home/dashboard');
});
```

```php
Route::post('user/profile', function () {
    // Validate the request...

    return back()->withInput();
});
```

## Redirecting To Named Routes

```php
return redirect()->route('login');
```

* With params:
```php
return redirect()->route('profile', ['id' => 1]);
```

## Populating Parameters Via Eloquent Models

```php
// For a route with the following URI: profile/{id}

return redirect()->route('profile', [$user]);
```

* To customize the value that is placed in the route parameter, override the `getRouteKey` method on the Eloquent model:

```php 
/**
 * Get the value of the model's route key.
 *
 * @return mixed
 */
public function getRouteKey()
{
    return $this->slug;
}
```

## Redirecting To Controller Actions

```php
return redirect()->action('HomeController@index');
```

* With params:

```php
return redirect()->action(
    'UserController@profile', ['id' => 1]
);
```

## Redirecting To External Domains

```php
return redirect()->away('https://www.google.com');
```

# Flash data

```php
Route::post('user/profile', function () {
    // Update the user's profile...

    return redirect('dashboard')->with('status', 'Profile updated!');
});
```

* Display the flashed message from the `session`. For example, using `Blade` syntax:
  
```blade
@if (session('status'))
    <div class="alert alert-success">
        {{ session('status') }}
    </div>
@endif
```

# Response Types

## View Responses

```php
return response()
            ->view('hello', $data, 200)
            ->header('Content-Type', $type);
```

* Of course, if you do not need to pass a custom HTTP status code or custom headers, you should use the global `view` helper function.

## JSON Responses

* The `json` method will automatically set the `Content-Type` header to `application/json`, as well as convert the given array to JSON using the `json_encode` PHP function:

```php
return response()->json([
    'name' => 'Abigail',
    'state' => 'CA'
]);
```

* JSONP 

```php
return response()
            ->json(['name' => 'Abigail', 'state' => 'CA'])
            ->withCallback($request->input('callback'));
```

## File Downloads

```php
return response()->download($pathToFile);

return response()->download($pathToFile, $name, $headers);

return response()->download($pathToFile)->deleteFileAfterSend(true);
```

* Symfony HttpFoundation, which manages file downloads, requires the file being downloaded to have an ASCII file name.

## File Responses

* The `file` method may be used to display a file, such as an image or PDF, directly in the user's browser instead of initiating a download:

```php
return response()->file($pathToFile);

return response()->file($pathToFile, $headers);
```

# Response Macros

```php
<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
use Illuminate\Support\Facades\Response;

class ResponseMacroServiceProvider extends ServiceProvider
{
    /**
     * Register the application's response macros.
     *
     * @return void
     */
    public function boot()
    {
        Response::macro('caps', function ($value) {
            return Response::make(strtoupper($value));
        });
    }
}
```

```php
return response()->caps('foo');
```

