# CSRF Protection

## Introduction

CSRF - cross-site request forgery.
Cross-site request forgeries are a type of malicious exploit whereby unauthorized commands are performed on behalf of an authenticated user.

Any HTML forms pointing to `POST`, `PUT`, or `DELETE` routes that are defined in the web routes file should include a CSRF token field.

* Laravel automatically generates a CSRF "token" for each active user session managed by the application.
* This token is used to verify that the authenticated user is the one actually making the requests to the application.

```blade
<form method="POST" action="/profile">
    {{ csrf_field() }}
    ...
</form>
```

* The `VerifyCsrfToken` middleware, which is included in the web middleware group, will automatically verify that the token in the request input matches the token stored in the session.

## Excluding URIs From CSRF Protection

* Typically, you should place these kinds of routes outside of the `web` middleware group that the  `RouteServiceProvider` applies to all routes in the `routes/web.php` file.
* However, you may also exclude the routes by adding their URIs to the `$except` property of the `VerifyCsrfToken` middleware.

```php
<?php

namespace App\Http\Middleware;

use Illuminate\Foundation\Http\Middleware\VerifyCsrfToken as Middleware;

class VerifyCsrfToken extends Middleware
{
    /**
     * The URIs that should be excluded from CSRF verification.
     *
     * @var array
     */
    protected $except = [
        'stripe/*',
        'http://example.com/foo/bar',
        'http://example.com/foo/*',
    ];
}
```

## X-CSRF-TOKEN

* In addition to checking for the CSRF token as a POST parameter, the `VerifyCsrfToken` middleware will also check for the `X-CSRF-TOKEN` request header.
* You could, for example, store the token in a HTML `meta` tag.

```
<meta name="csrf-token" content="{{ csrf_token() }}">
```

* Then, once you have created the meta tag, you can instruct a library like jQuery to automatically add the token to all request headers. 

```js
$.ajaxSetup({
    headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    }
});
```

## X-XSRF-TOKEN

* Laravel stores the current CSRF token in a XSRF-TOKEN cookie that is included with each response generated by the framework.
* You can use the cookie value to set the X-XSRF-TOKEN request header.

# XSS

XSS - Cross-site scripting

Blade `{{ }}` statements are automatically sent through PHP's `htmlspecialchars` function to prevent XSS attacks.
